# Node.js v0.12.18 ä¸­çš„ V8 å¼•æ“æºç è¯¦è§£

## ğŸ¯ é—®é¢˜å›ç­”

**æ˜¯çš„ï¼è¿™ä¸ª Node.js v0.12.18 æºç åŒ…ä¸­ç¡®å®åŒ…å«äº† V8 å¼•æ“çš„å®Œæ•´æºç ï¼**

## ğŸ“ V8 æºç ç»“æ„åˆ†æ

### 1. æºç ä½ç½®
```
node-v0.12.18/
â””â”€â”€ deps/
    â””â”€â”€ v8/                    # V8 å¼•æ“å®Œæ•´æºç 
        â”œâ”€â”€ src/              # æ ¸å¿ƒæºç  (340+ ä¸ªæ–‡ä»¶)
        â”œâ”€â”€ include/          # å¤´æ–‡ä»¶
        â”œâ”€â”€ samples/          # ç¤ºä¾‹ä»£ç 
        â”œâ”€â”€ tools/            # æ„å»ºå·¥å…·
        â”œâ”€â”€ benchmarks/       # æ€§èƒ½æµ‹è¯•
        â””â”€â”€ third_party/      # ç¬¬ä¸‰æ–¹ä¾èµ–
```

### 2. æºç ç»Ÿè®¡
- **C++ æºæ–‡ä»¶**: 143 ä¸ª `.cc` æ–‡ä»¶
- **å¤´æ–‡ä»¶**: 197 ä¸ª `.h` æ–‡ä»¶
- **JavaScript æ–‡ä»¶**: 30 ä¸ª `.js` æ–‡ä»¶
- **æ€»è®¡**: 340+ ä¸ªæºç æ–‡ä»¶

### 3. V8 ç‰ˆæœ¬ä¿¡æ¯
æ ¹æ® `deps/v8/ChangeLog` æ–‡ä»¶ï¼Œè¿™ä¸ªç‰ˆæœ¬åŒ…å«çš„æ˜¯ï¼š
- **V8 ç‰ˆæœ¬**: 3.28.71 (2014å¹´8æœˆ12æ—¥)
- **ç‰¹æ€§**: æ”¯æŒ ES6 éƒ¨åˆ†ç‰¹æ€§
- **æ€§èƒ½**: åŒ…å«å¤šé¡¹æ€§èƒ½ä¼˜åŒ–

## ğŸ” V8 æºç ç›®å½•è¯¦è§£

### 1. src/ ç›®å½• - æ ¸å¿ƒå®ç°
```
deps/v8/src/
â”œâ”€â”€ api/                    # V8 API å®ç°
â”œâ”€â”€ ast/                    # æŠ½è±¡è¯­æ³•æ ‘
â”œâ”€â”€ base/                   # åŸºç¡€å·¥å…·ç±»
â”œâ”€â”€ bootstrapper/           # å¯åŠ¨å¼•å¯¼å™¨
â”œâ”€â”€ codegen/               # ä»£ç ç”Ÿæˆå™¨
â”œâ”€â”€ compiler/              # ç¼–è¯‘å™¨
â”œâ”€â”€ debug/                 # è°ƒè¯•å™¨
â”œâ”€â”€ deoptimizer/           # åä¼˜åŒ–å™¨
â”œâ”€â”€ execution/             # æ‰§è¡Œå¼•æ“
â”œâ”€â”€ full-codegen/          # å®Œæ•´ä»£ç ç”Ÿæˆå™¨
â”œâ”€â”€ heap/                  # å †å†…å­˜ç®¡ç†
â”œâ”€â”€ ic/                    # å†…è”ç¼“å­˜
â”œâ”€â”€ interpreter/           # è§£é‡Šå™¨
â”œâ”€â”€ isolate/               # éš”ç¦»å™¨
â”œâ”€â”€ libplatform/          # å¹³å°æŠ½è±¡å±‚
â”œâ”€â”€ messages/              # é”™è¯¯æ¶ˆæ¯
â”œâ”€â”€ objects/               # JavaScript å¯¹è±¡å®ç°
â”œâ”€â”€ parser/                # è§£æå™¨
â”œâ”€â”€ profiler/              # æ€§èƒ½åˆ†æå™¨
â”œâ”€â”€ runtime/               # è¿è¡Œæ—¶ç³»ç»Ÿ
â”œâ”€â”€ snapshot/              # å¿«ç…§ç³»ç»Ÿ
â”œâ”€â”€ startup/               # å¯åŠ¨ä»£ç 
â”œâ”€â”€ test/                  # æµ‹è¯•ä»£ç 
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
```

### 2. include/ ç›®å½• - å…¬å…±æ¥å£
```
deps/v8/include/
â”œâ”€â”€ v8.h                   # ä¸»è¦ V8 API (æ‚¨åˆšæ‰çœ‹åˆ°çš„)
â”œâ”€â”€ v8-debug.h            # è°ƒè¯• API
â”œâ”€â”€ v8-platform.h         # å¹³å° API
â”œâ”€â”€ v8-profiler.h         # æ€§èƒ½åˆ†æ API
â”œâ”€â”€ v8-testing.h          # æµ‹è¯• API
â”œâ”€â”€ v8-util.h             # å·¥å…· API
â””â”€â”€ libplatform/          # å¹³å°åº“æ¥å£
```

### 3. samples/ ç›®å½• - ç¤ºä¾‹ä»£ç 
```
deps/v8/samples/
â”œâ”€â”€ shell.cc              # V8 Shell ç¤ºä¾‹
â”œâ”€â”€ process.cc            # è¿›ç¨‹ç¤ºä¾‹
â”œâ”€â”€ lineprocessor.cc      # è¡Œå¤„ç†å™¨ç¤ºä¾‹
â””â”€â”€ count-hosts.js        # JavaScript ç¤ºä¾‹
```

## ğŸ”§ V8 åœ¨ Node.js ä¸­çš„é›†æˆ

### 1. æ„å»ºé…ç½®
Node.js é€šè¿‡ä»¥ä¸‹æ–‡ä»¶é…ç½® V8 çš„æ„å»ºï¼š

```python
# deps/v8/build/v8.gyp - V8 æ„å»ºé…ç½®
{
  'targets': [
    {
      'target_name': 'v8_base',
      'type': 'static_library',
      'sources': [
        'src/api.cc',
        'src/ast.cc',
        # ... æ›´å¤šæºæ–‡ä»¶
      ]
    }
  ]
}
```

### 2. Node.js ä¸­çš„ V8 ä½¿ç”¨
```cpp
// src/node.cc - Node.js å¦‚ä½•ä½¿ç”¨ V8
#include "v8.h"  // åŒ…å« V8 å¤´æ–‡ä»¶

// V8 åˆå§‹åŒ–
V8::Initialize();

// åˆ›å»ºéš”ç¦»å™¨
Isolate* isolate = Isolate::New();

// åˆ›å»ºä¸Šä¸‹æ–‡
Local<Context> context = Context::New(isolate);
```

## ğŸ“Š V8 æºç æ ¸å¿ƒç»„ä»¶

### 1. JavaScript å¼•æ“æ ¸å¿ƒ
- **è§£æå™¨ (Parser)**: å°† JavaScript ä»£ç è§£æä¸º AST
- **ç¼–è¯‘å™¨ (Compiler)**: å°† AST ç¼–è¯‘ä¸ºæœºå™¨ç 
- **è§£é‡Šå™¨ (Interpreter)**: è§£é‡Šæ‰§è¡Œ JavaScript ä»£ç 
- **åƒåœ¾æ”¶é›†å™¨ (GC)**: ç®¡ç†å†…å­˜åˆ†é…å’Œå›æ”¶

### 2. å¯¹è±¡ç³»ç»Ÿ
```cpp
// V8 ä¸­çš„ JavaScript å¯¹è±¡å®ç°
class Object : public Value {
  // JavaScript å¯¹è±¡çš„æ‰€æœ‰æ“ä½œ
};

class String : public Primitive {
  // å­—ç¬¦ä¸²ç±»å‹çš„å®ç° (æ‚¨åˆšæ‰çœ‹åˆ°çš„)
};

class Number : public Primitive {
  // æ•°å­—ç±»å‹çš„å®ç°
};
```

### 3. æ‰§è¡Œå¼•æ“
- **Ignition**: å­—èŠ‚ç è§£é‡Šå™¨
- **TurboFan**: ä¼˜åŒ–ç¼–è¯‘å™¨
- **Crankshaft**: ä¼ ç»Ÿä¼˜åŒ–ç¼–è¯‘å™¨ (v0.12.18 æ—¶æœŸ)

## ğŸ¯ å­¦ä¹ ä»·å€¼

### 1. æ·±å…¥ç†è§£ JavaScript å¼•æ“
é€šè¿‡é˜…è¯» V8 æºç ï¼Œæ‚¨å¯ä»¥äº†è§£ï¼š
- JavaScript ä»£ç å¦‚ä½•è¢«è§£æå’Œç¼–è¯‘
- å¯¹è±¡åœ¨å†…å­˜ä¸­å¦‚ä½•è¡¨ç¤º
- åƒåœ¾æ”¶é›†å™¨å¦‚ä½•å·¥ä½œ
- æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯

### 2. å­¦ä¹ ä¼˜ç§€çš„ C++ è®¾è®¡
V8 æºç å±•ç¤ºäº†ï¼š
- å¤§å‹ C++ é¡¹ç›®çš„æ¶æ„è®¾è®¡
- å†…å­˜ç®¡ç†æœ€ä½³å®è·µ
- è·¨å¹³å°å¼€å‘æŠ€æœ¯
- æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 3. ç†è§£ Node.js å·¥ä½œåŸç†
- V8 å¦‚ä½•ä¸ Node.js é›†æˆ
- JavaScript ä¸ C++ çš„äº’æ“ä½œ
- äº‹ä»¶å¾ªç¯çš„å®ç°åŸç†

## ğŸ” å…³é”®æºç æ–‡ä»¶æ¨è

### 1. å…¥é—¨æ–‡ä»¶
- `deps/v8/src/api.cc` - V8 API å®ç°
- `deps/v8/src/isolate.cc` - éš”ç¦»å™¨å®ç°
- `deps/v8/src/context.cc` - ä¸Šä¸‹æ–‡å®ç°

### 2. æ ¸å¿ƒç»„ä»¶
- `deps/v8/src/parser.cc` - JavaScript è§£æå™¨
- `deps/v8/src/compiler.cc` - ç¼–è¯‘å™¨
- `deps/v8/src/heap/heap.cc` - å †å†…å­˜ç®¡ç†

### 3. å¯¹è±¡ç³»ç»Ÿ
- `deps/v8/src/objects.cc` - å¯¹è±¡å®ç°
- `deps/v8/src/string.cc` - å­—ç¬¦ä¸²å®ç°
- `deps/v8/src/numbers.cc` - æ•°å­—å®ç°

## ğŸš€ å®è·µå»ºè®®

### 1. æºç é˜…è¯»é¡ºåº
1. **API å±‚**: ä» `include/v8.h` å¼€å§‹
2. **åŸºç¡€ç»„ä»¶**: é˜…è¯» `src/api.cc` å’Œ `src/isolate.cc`
3. **å¯¹è±¡ç³»ç»Ÿ**: æ·±å…¥ `src/objects/` ç›®å½•
4. **æ‰§è¡Œå¼•æ“**: ç ”ç©¶ `src/execution/` ç›®å½•

### 2. è°ƒè¯•æŠ€å·§
```bash
# ç¼–è¯‘å¸¦è°ƒè¯•ä¿¡æ¯çš„ V8
./configure --debug --gdb

# ä½¿ç”¨ GDB è°ƒè¯•
gdb ./node
(gdb) break v8::String::NewFromUtf8
(gdb) run
```

### 3. å­¦ä¹ å·¥å…·
- **V8 Shell**: ä½¿ç”¨ `deps/v8/samples/shell.cc` æµ‹è¯•
- **æ€§èƒ½åˆ†æ**: ä½¿ç”¨ V8 å†…ç½®çš„æ€§èƒ½åˆ†æå·¥å…·
- **å†…å­˜åˆ†æ**: ä½¿ç”¨ `--trace-gc` å‚æ•°è§‚å¯Ÿåƒåœ¾æ”¶é›†

## ğŸ“ æ€»ç»“

Node.js v0.12.18 åŒ…å«äº†å®Œæ•´çš„ V8 å¼•æ“æºç ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„å­¦ä¹ èµ„æºï¼š

1. **å®Œæ•´æ€§**: åŒ…å« V8 çš„æ‰€æœ‰æ ¸å¿ƒç»„ä»¶
2. **å¯ç¼–è¯‘**: å¯ä»¥ç‹¬ç«‹ç¼–è¯‘å’Œè¿è¡Œ
3. **å¯è°ƒè¯•**: æ”¯æŒå®Œæ•´çš„è°ƒè¯•åŠŸèƒ½
4. **æ–‡æ¡£ä¸°å¯Œ**: åŒ…å«å¤§é‡æ³¨é‡Šå’Œæ–‡æ¡£

é€šè¿‡ç ”ç©¶è¿™äº›æºç ï¼Œæ‚¨å¯ä»¥ï¼š
- æ·±å…¥ç†è§£ JavaScript å¼•æ“çš„å·¥ä½œåŸç†
- å­¦ä¹ ä¼˜ç§€çš„ C++ ç¼–ç¨‹æŠ€å·§
- æŒæ¡ Node.js çš„å†…éƒ¨å®ç°æœºåˆ¶
- æå‡ç³»ç»Ÿç¼–ç¨‹å’Œæ€§èƒ½ä¼˜åŒ–èƒ½åŠ›

è¿™æ˜¯ä¸€ä¸ªéå¸¸å®è´µçš„å­¦ä¹ èµ„æºï¼Œå€¼å¾—æ·±å…¥ç ”ç©¶å’Œå­¦ä¹ ï¼

